---
layout: "page"
title: old spotify pie
permalink: /old-spotify-pie
---
<!doctype html>
<html lang="en">

<head>
  <meta name="ahrefs-site-verification" content="f9805fd529e993ad2b1929b09f27c0b69fbda9fad04acead603f2847527f3b52">
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <title>Spotify Pie - Old Version</title>
  <meta name="description" content="For those who missed the old version of Spotify Pie">

  <meta name="robots" content="index, follow">

  <meta property="og:title" content="Spotify Pie - Old Version">
<meta property="og:description" content="For those who missed the old version of Spotify Pie">
<meta property="og:image" content="https://huangdarren1106.github.io/">
<meta property="og:url" content="https://huangdarren1106.github.io/old-spotify-pie">
<meta property="og:site_name" content="Spotify Pie - Exploring Your Spotify Stats in a Fun Way">
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<link rel="canonical" href="https://huangdarren1106.github.io/old-spotify-pie">

  <meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Spotify Pie - Old Version">
<meta name="twitter:description" content="For those who missed the old version of Spotify Pie">
<meta name="twitter:image" content="https://huangdarren1106.github.io/">
<meta name="twitter:image:alt" content="Spotify Pie - Old Version">

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;0,500;0,600;0,700;1,500&family=Victor+Mono&display=swap"
    rel="stylesheet">

 

  <script defer data-domain="huangdarren1106.github.io" src="https://stats.senty.com.au/js/script.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3723218062742398"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/addon-interscroller@1.0.5/dist/interscroller.js"></script>
<script src="https://stpd.cloud/assets/libraries/inview.min.js"></script>
<script>
    inView.offset(-200);
</script>
<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<script>
    window.googletag = window.googletag || {};
    googletag.cmd = googletag.cmd || [];

    function giveReward(url) {
        googletag.pubads().removeEventListener('rewardedSlotClosed', dismissReward);
        window.location.href = url;
    }

    function dismissReward(evt) {
        googletag.destroySlots([evt.rewardedSlot]);
    }

    function showAd(url) {
        googletag.cmd.push(function() {
            var rewardedSlot = googletag.defineOutOfPageSlot(
                '/147246189,22921845643/huangdarren1106.github.io_rewarded', googletag.enums.OutOfPageFormat
                .REWARDED); // CHANGEABLE. Rewarded ad unit
            if (rewardedSlot) {
                rewardedSlot.addService(googletag.pubads());
            }
            googletag.pubads().addEventListener('rewardedSlotReady', function(evt) {
                evt.makeRewardedVisible();
            });
            googletag.pubads().addEventListener('rewardedSlotClosed', dismissReward);
            googletag.pubads().addEventListener('rewardedSlotGranted', function() {
                giveReward(url);
            });

            googletag.display(rewardedSlot);
            googletag.pubads().refresh([rewardedSlot]);
        });
    }

    googletag.cmd.push(function() {
        if (window.innerWidth >= 1480) {
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_1000x100_desktop_anchor', [
                [1000, 100],
                [970, 90],
                [728, 90],
                [990, 90],
                [970, 50],
                [960, 90],
                [950, 90],
                [980, 90]
            ], 'huangdarren1106_github_io_anchor_ad_responsive').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_300x600_desktop_side_left', [
                [300, 600],
                [160, 600],
                [300, 250],
                [300, 300]
            ], 'huangdarren1106_github_io_sidebar_left_desktop').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_300x600_desktop_side_right',
                [
                    [300, 600],
                    [160, 600],
                    [300, 250],
                    [300, 300]
                ], 'huangdarren1106_github_io_sidebar_right_desktop').addService(googletag.pubads());
            googletag.defineSlot(
                '/147246189,22921845643/huangdarren1106.github.io_800x280_desktop_billboard_top', [
                    [800, 280],
                    [800, 250],
                    [800, 200],
                    [750, 280],
                    [750, 250],
                    [750, 200],
                    [750, 150],
                    [750, 100],
                    [728, 90]
                ], 'huangdarren1106_github_io_billboard_top_responsive').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_320x100_mobile_anchor_top', [
                [320, 100],
                [320, 50],
                [300, 100],
                [300, 50]
            ], 'huangdarren1106_github_io_anchor_ad_top_mobile').addService(googletag.pubads());
        } else if (window.innerWidth >= 1180) {
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_1000x100_desktop_anchor', [
                [1000, 100],
                [970, 90],
                [728, 90],
                [990, 90],
                [970, 50],
                [960, 90],
                [950, 90],
                [980, 90]
            ], 'huangdarren1106_github_io_anchor_ad_responsive').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_160x600_desktop_side_left', [
                [160, 600],
                [120, 600]
            ], 'huangdarren1106_github_io_sidebar_left_desktop').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_160x600_desktop_side_right',
                [
                    [160, 600],
                    [120, 600]
                ], 'huangdarren1106_github_io_sidebar_right_desktop').addService(googletag.pubads());
            googletag.defineSlot(
                '/147246189,22921845643/huangdarren1106.github.io_800x280_desktop_billboard_top', [
                    [800, 280],
                    [800, 250],
                    [800, 200],
                    [750, 280],
                    [750, 250],
                    [750, 200],
                    [750, 150],
                    [750, 100],
                    [728, 90]
                ], 'huangdarren1106_github_io_billboard_top_responsive').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_320x100_mobile_anchor_top', [
                [320, 100],
                [320, 50],
                [300, 100],
                [300, 50]
            ], 'huangdarren1106_github_io_anchor_ad_top_mobile').addService(googletag.pubads());
        } else if (window.innerWidth >= 1024) {
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_1000x100_desktop_anchor', [
                [1000, 100],
                [970, 90],
                [728, 90],
                [990, 90],
                [970, 50],
                [960, 90],
                [950, 90],
                [980, 90]
            ], 'huangdarren1106_github_io_anchor_ad_responsive').addService(googletag.pubads());
            googletag.defineSlot(
                '/147246189,22921845643/huangdarren1106.github.io_800x280_desktop_billboard_top', [
                    [800, 280],
                    [800, 250],
                    [800, 200],
                    [750, 280],
                    [750, 250],
                    [750, 200],
                    [750, 150],
                    [750, 100],
                    [728, 90]
                ], 'huangdarren1106_github_io_billboard_top_responsive').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_320x100_mobile_anchor_top', [
                [320, 100],
                [320, 50],
                [300, 100],
                [300, 50]
            ], 'huangdarren1106_github_io_anchor_ad_top_mobile').addService(googletag.pubads());
        } else {
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_320x100_mobile_anchor', [
                [320, 100],
                [320, 50],
                [300, 100],
                [300, 50]
            ], 'huangdarren1106_github_io_anchor_ad_responsive').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_336x336_mobile_top', [
                [300, 250],
                [336, 336],
                [336, 320],
                [320, 320],
                [300, 300],
                [336, 280],
                [320, 250],
                [320, 336]
            ], 'huangdarren1106_github_io_billboard_top_responsive').addService(googletag.pubads());
            googletag.defineSlot(
                '/147246189,22921845643/huangdarren1106.github.io_300x600_mobile_interscroller', [
                    [300, 600],
                    [160, 600],
                    [300, 250],
                    [300, 300]
                ], 'huangdarren1106_github_io_interscroller_mobile').addService(googletag.pubads());
            googletag.defineSlot('/147246189,22921845643/huangdarren1106.github.io_320x100_mobile_anchor_top', [
                [320, 50],
                [300, 50]
            ], 'huangdarren1106_github_io_anchor_ad_top_mobile').addService(googletag.pubads());
        }
        var interstitialSlot = googletag.defineOutOfPageSlot(
            '/147246189,22921845643/huangdarren1106.github.io_interstitial', googletag.enums.OutOfPageFormat
            .INTERSTITIAL);
        if (interstitialSlot) interstitialSlot.addService(googletag.pubads());

        googletag.pubads().enableSingleRequest();
        googletag.pubads().disableInitialLoad();
        googletag.pubads().collapseEmptyDivs();
        googletag.pubads().setTargeting('category', 'music')
            .setTargeting('audience_interest', [
                'music', 'spotify', 'spotify premium', 'apple music', 'music streaming', 'music charts',
                'music analysis', 'music data', 'music statistics', 'music trends', 'music insights',
                'music discovery', 'music recommendations', 'music genres', 'music artists', 'music albums',
                'music songs', 'music playlists'
            ]);
        googletag.enableServices();
        googletag.display(interstitialSlot);
    });
</script>
<script async src="https://stpd.cloud/saas/6406"></script>
<style>
    .side_ad_left {
        top: 75px;
        left: 10px;
        position: fixed;
    }

    .side_ad_right {
        top: 75px;
        right: 10px;
        position: fixed;

        .ads {
            text-align: center;
        }
</style>

  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">

  <meta name="google-site-verification" content="0I5jWqQYG7ahDKO-xLIJWViQ8SPeE0SgnfbaXjFInkU" />

  
  <link rel="preload" as="style" href="https://huangdarren1106.github.io/build/assets/app-oRXaRPT5.css" /><link rel="modulepreload" href="https://huangdarren1106.github.io/build/assets/app-ARot55nG.js" /><link rel="stylesheet" href="https://huangdarren1106.github.io/build/assets/app-oRXaRPT5.css" /><script type="module" src="https://huangdarren1106.github.io/build/assets/app-ARot55nG.js"></script>       <style>
         #genre-popover {
             position: absolute;
             background-color: white;
             border: 1px solid #ccc;
             padding: 10px;
             border-radius: 5px;
             display: none;
             z-index: 10;
         }
     </style>
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 </head>

<body class="relative">


  <div class="max-w-2xl px-4 pt-8 mx-auto prose prose-lg prose-img:text-center prose-img:mx-auto lg:px-0">
   
    <h1 class="text-3xl text-center text-gray-900 sm:text-5xl">Spotify Pie - Old Version</h1>
    
          <div x-data="app" class="max-w-xl mx-auto px-4 lg:px-0 prose">

     <div class="text-center flex justify-center my-4">
         <a href="/spotify-pie" class="flex items">New Spotify Pie is here</a>
     </div>

     <div x-show="!token" class="text-center my-8">
         <a :href="spotifyAuthUrl"
             class="no-underline bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full">Login to
             Spotify</a>
     </div>
     <div x-show="token" class="mt-8">
         <div x-show="isMounted" class="w-[300px] sm:w-[506px] mx-auto">
             <canvas width="506px" id="piChart"></canvas>
         </div>
         <div class="mt-8 flex flex-col justify-center text-center font-metropolis">
             <template x-for="(artist, index) in topArtists" :key="artist.id">
                 <div class="">
                     <span :style="getArtistStyle(index)" class="font-semibold leading-none space-nowrap"
                         x-text="artist.name"></span>
                 </div>
             </template>
         </div>
     </div>
 </div>

 

  </div>
       

    <article>
              
          </article>

    <div class="max-w-3xl px-4 mx-auto text-center lg:px-0">
  <script src="https://360playvid.info/slidepleer/d1999d.js"></script>
</div>

  </div>


       <script>
         function app() {
             const authEndpoint = 'https://accounts.spotify.com/authorize';
             const clientId = 'edd26169edf844db89a92b56cbb54b85';
             // remove trailing slash from redirect uri
             const redirectUri = window.location.href.replace(/\/$/, "");
             const scopes = ['user-top-read', "user-read-currently-playing", "user-read-playback-state"];
             return {
                 token: null,
                 uuid: null,
                 expiry: null,
                 spotifyAuthUrl: `${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${
            scopes.join("%20")
          }&response_type=token&show_dialog=true`,
                 isMounted: false,
                 piData: {},
                 topArtists: [],
                 artistToGenres: [],
                 getArtistStyle(index) {
                     const baseSize = 36; // The font size for the top artist in pixels
                     const decrement = 1.5; // The amount by which font size decreases for each subsequent artist in pixels
                     const size = baseSize - (index * decrement);
                     return `font-size: ${size}px;`;
                 },

                 async init() {
                     // read token from local storage
                     this.token = localStorage.getItem('token');
                     console.log(this.token)
                     if (this.token) {
                         try {
                             await this.getTopArtists(this.time_range)
                             await this.getProfile()
                         } catch (e) {
                             console.log(e);
                         }

                     }
                 },
                 async getTopArtists() {
                     // Your axios logic here to fetch top artists, process the data, and set the piData and artistToGenres Update the
                     // isMounted variable accordingly
                     const headers = {
                         "Authorization": "Bearer " + this.token,
                         "Accept": "application/json, text/plain, */*",
                     };
                     await fetch("https://api.spotify.com/v1/me/top/artists", {
                         headers
                     }).then(response => response.json()).then(data => {
                         this.topArtists = data.items;
                     });



                     const currArtistsToGenres = this
                         .topArtists
                         .map((artist, index) => {
                             const artistName = artist.name;
                             const imageURL = artist.images[0].url;
                             const genresArr = artist.genres;
                             return {
                                 artistName: artistName,
                                 genresArr: genresArr
                             }
                         })
                     this
                         .artistToGenres = currArtistsToGenres;
                     const unorganizedGenres = this.topArtists.map((artist, index) => {
                         const genreArr = artist.genres;
                         return genreArr;
                     })
                     const allGenres = [].concat(...unorganizedGenres)
                     // sort frequency
                     var frequency = {};
                     allGenres.map((genre) => {
                         frequency[genre] = 0;
                     })
                     allGenres.map((genre) => {
                         frequency[genre] = frequency[genre] + 1;
                     })
                     var keys = Object.keys(frequency);
                     var vals = Object.values(frequency);
                     var a = 0;
                     var finalArr = [];
                     while (a != 20 && keys.length != 0) {
                         var currIndex = indexOfMax(vals);
                         finalArr.push(keys[currIndex]);
                         keys.splice(currIndex, 1);
                         vals.splice(currIndex, 1);
                         a++;
                     }
                     var finalObj = {};
                     finalArr.map((genre) => {
                         finalObj[genre] = frequency[genre];
                     })
                     const sum = Object.values(finalObj).reduce((partialSum, a) => partialSum + a, 0);
                     console.log(sum)
                     var currPiData = {
                         labels: Object.keys(finalObj),
                         datasets: [{
                             label: "Your Top Genres",
                             data: Object.values(finalObj).map((value) => {
                                 return Math.round((value / sum) * 100) / 100;
                             }),
                             backgroundColor: [
                                 '#FF6384',
                                 '#36A2EB',
                                 '#FFCE56',
                                 '#4BC0C0',
                                 '#9966FF',
                                 '#FF9F40',
                                 '#FFCD56',
                                 '#4DB6AC',
                                 '#F44336',
                                 '#E91E63',
                                 '#9C27B0',
                                 '#673AB7',
                                 '#3F51B5',
                                 '#2196F3',
                                 '#03A9F4',
                                 '#00BCD4',
                                 '#009688',
                                 '#4CAF50',
                                 '#8BC34A',
                                 '#CDDC39',
                                 '#FFEB3B',
                                 '#FFC107',
                                 '#FF9800',
                                 '#FF5722',
                                 '#795548',
                                 '#9E9E9E',
                                 '#607D8B'
                             ],
                             borderColor: "white",
                             radius: "100%"
                         }]
                     }
                     this.piData = currPiData;
                     console.log(currPiData)
                     this.isMounted = true;
                     this.initChart();
                 },
                 initChart() {
                     const ctx = document.getElementById('piChart').getContext('2d');
                     new Chart(ctx, {
                         type: 'pie',
                         data: this.piData,
                         options: { // responsive: true, Your chart options here
                             plugins: {
                                 legend: {
                                     display: true,
                                     position: "bottom",
                                     labels: {
                                         color: "#000000",
                                         boxWidth: 20,
                                         padding: 5,
                                         font: {
                                             size: 12
                                         }
                                     }
                                 },
                                 tooltip: {
                                     callbacks: {
                                         label: function(context) {
                                             var initialLabel = context.label + ": ";
                                             var artists = [];
                                             this
                                                 .artistToGenres
                                                 .map((artist) => {
                                                     if (artist.genresArr.includes(context.label)) {
                                                         artists.push(artist.artistName);
                                                     }
                                                 })
                                             artists
                                                 .map((artist) => {
                                                     initialLabel = initialLabel + artist + ", "
                                                 });
                                             initialLabel = initialLabel.substring(0, initialLabel.length - 2);
                                             return initialLabel;
                                         }.bind(this) // Bind to access outer scope's 'this'
                                     }
                                 }
                             }
                         }
                     });
                     this.makeSharable()
                 },
                 // Additional functions like indexOfMax and others can be added here
                 readToken() { // Extract the token from the URL hash
                     const hash = window
                         .location
                         .hash
                         .substring(1)
                         .split("&")
                         .reduce((initial, item) => {
                             if (item) {
                                 var parts = item.split("=");
                                 initial[parts[0]] = decodeURIComponent(parts[1]);
                             }
                             return initial;
                         }, {});
                     this.token = hash.access_token;
                     this.expiry = 3600 + Math.floor(Date.now() / 1000);
                     this.removeHash()
                 },
                 removeHash() {
                     var scrollV, scrollH, loc = window.location;
                     if ("pushState" in history)
                         history.pushState("", document.title, loc.pathname + loc.search);
                     else {
                         // Prevent scrolling by storing the page's current scroll offset
                         scrollV = document.body.scrollTop;
                         scrollH = document.body.scrollLeft;

                         loc.hash = "";

                         // Restore the scroll offset, should be flicker free
                         document.body.scrollTop = scrollV;
                         document.body.scrollLeft = scrollH;
                     }
                 }
             }
         }
         const indexOfMax = (arr) => {
             if (arr.length === 0) {
                 return -1;
             }
             var max = arr[0];
             var maxIndex = 0;
             for (var i = 1; i < arr.length; i++) {
                 if (arr[i] > max) {
                     maxIndex = i;
                     max = arr[i];
                 }
             }
             return maxIndex;
         }
     </script>
   <script>
    function modifyElement() {
        var rewardBtns = top.document.querySelectorAll(' .rewarded');
        if (rewardBtns.length > 0) {
            rewardBtns.forEach(function(rewardBtn) {
                rewardBtn.setAttribute('data-google-interstitial', 'false');
                var hrefValue = rewardBtn.getAttribute('href');
                rewardBtn.removeAttribute('href');
                rewardBtn.setAttribute('onclick', 'showAd("' + hrefValue + '")');
            });
        } else {
            setTimeout(modifyElement, 100);
        }
    }
    modifyElement();
</script>
</body>

</html>
